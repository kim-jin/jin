<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>羊肉粉 | 羊肉粉</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="今天发现一篇说log4j的比较好的文章，纪录一下：log4j

log4j 简介

几乎每个大的应用程序都有它自己的日志和跟踪程序的API 。顺应这一规则，E.U. SEMPER 项目组决定编写它自己的程序跟踪API （tracing API ）。这开始于1996 年早期。经过无数的工作，更改和性能加强，这个API 终于成为一个十分受欢迎的Java 日志软件包，那就是log4j 。这个软件包的发行">
<meta property="og:type" content="article">
<meta property="og:title" content="羊肉粉">
<meta property="og:url" content="http://kim.biudoor.com/2015/08/09/log4j/">
<meta property="og:site_name" content="羊肉粉">
<meta property="og:description" content="今天发现一篇说log4j的比较好的文章，纪录一下：log4j

log4j 简介

几乎每个大的应用程序都有它自己的日志和跟踪程序的API 。顺应这一规则，E.U. SEMPER 项目组决定编写它自己的程序跟踪API （tracing API ）。这开始于1996 年早期。经过无数的工作，更改和性能加强，这个API 终于成为一个十分受欢迎的Java 日志软件包，那就是log4j 。这个软件包的发行">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="羊肉粉">
<meta name="twitter:description" content="今天发现一篇说log4j的比较好的文章，纪录一下：log4j

log4j 简介

几乎每个大的应用程序都有它自己的日志和跟踪程序的API 。顺应这一规则，E.U. SEMPER 项目组决定编写它自己的程序跟踪API （tracing API ）。这开始于1996 年早期。经过无数的工作，更改和性能加强，这个API 终于成为一个十分受欢迎的Java 日志软件包，那就是log4j 。这个软件包的发行">

  
    <link rel="alternative" href="/atom.xml" title="羊肉粉" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">羊肉粉</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">naive</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://kim.biudoor.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-log4j" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/09/log4j/" class="article-date">
  <time datetime="2015-08-08T16:00:00.000Z" itemprop="datePublished">2015年08月9日</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技术/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      羊肉粉
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天发现一篇说log4j的比较好的文章，纪录一下：<br>log4j</p>
<ol>
<li>log4j 简介</li>
</ol>
<p>几乎每个大的应用程序都有它自己的日志和跟踪程序的API 。顺应这一规则，E.U. SEMPER 项目组决定编写它自己的程序跟踪API （tracing API ）。这开始于1996 年早期。经过无数的工作，更改和性能加强，这个API 终于成为一个十分受欢迎的Java 日志软件包，那就是log4j 。这个软件包的发行遵守open source 动议认证的Apache Software License 。最新的log4j 版本包括全部的源代码，类文件和文档资料，可以在<a href="http://logging.apache.org/log4j/" target="_blank" rel="external">http://logging.apache.org/log4j/</a> 找到它们。另外，log4j 已经被转换成 C, C++, C#, Perl, Python, Ruby, 和 Eiffel 语言。</p>
<p>Log4j 是Apache 的一个开放源代码项目，通过使用Log4j ，我们可以控制日志信息输送的目的地是控制台、文件、GUI 组件、甚至是套接口服务 器、NT 的事件记录器、UNIX Syslog 守护进程等；我们也可以控制每一条日志的输出格式；通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。最令人感兴趣的就 是，这些可以通过一个配置文件来灵活地进行配置，而不需要修改应用的代码。</p>
<p>在应用程序中输出日志有三个目的： </p>
<p>（1 ）监视代码中变量的变化情况，把数据周期性地记录到文件中供其他应用进行统计分析工作。</p>
<p>（2 ）跟踪代码运行轨迹，作为日后审计的依据。</p>
<p>（3 ）担当集成开发环境中的调试器，向文件或控制台打印代码的调试信息。</p>
<p>　　Apache 能用日志包（Commons Logging Package ）是Apache 的一个开放源代码项目，它提供了一组通用的日志接口，用户可以自由地选择实现日志接口的第三方软件。通用日志包目前支持以下日志实现： </p>
<p>Log4J 日志器（ <a href="http://jakarta.apache.org/log4j" target="_blank" rel="external">http://jakarta.apache.org/log4j</a> ） </p>
<p>JDK1.4 Logging 日志器 (JDK1.4 自带 ) </p>
<p>SimpleLog 日志器 ( 把日志消息输出到标准系统错误流 System.err) </p>
<p>NoOpLog( 不输出任何日志信息 ) </p>
<p>1.1 日志中两个常用的接口：LogFactory<br>和Log </p>
<p>1.1.1 Log 接口</p>
<p>通用日志包把消息分为6 个级别：FATAL 、ERROR 、WARN 、INFO 、DEBUG 和TRACE 。其中FATAL 级别最高，TRACE 级别最低。Log 接口提供输出不同级别消息的方法： </p>
<p>off————————————————- 最高等级的，用于关闭所有日志记录 </p>
<p>fatal(Object message)———- 输出FATAL 级别的消息。 </p>
<p>error(Object message)———- 输出ERROR 级别的消息。 </p>
<p>warn(Object message)———- 输出WARN 级别的消息。 </p>
<p>info(Object message)———- 输出INFO 级别的消息。 </p>
<p>debug(Object message)———- 输出DEBUG 级别的消息。 </p>
<p>trace(Object message)———- 输出TRACE 级别的消息。 </p>
<p>all————————————————— 最低等级的，用于打开所有日志记录 </p>
<p>注：Loggers 组件在此系统中被分为五个级别：DEBUG 、INFO 、WARN 、ERROR 和FATAL 。这五个级别是有顺序的，DEBUG &lt; INFO &lt; WARN &lt; ERROR<br>&lt; FATAL ，分别用来指定这条日志信息的重要程度, 明白这一点很重要，这里Log4j 有一个规则：假设Loggers 级别为P ，如果在Loggers 中发生了一个级别Q 比P 高，则可以启动，否则屏蔽掉。假设你定义的级别是info ，那么error 和warn 的日志可以显示而比他低的debug 信息就不显示了</p>
<p>1.1.2 LogFactory 接口 </p>
<p>LogFactory 接口提供了获得日志器实例的两个静态方法： </p>
<p>public static Log getLog(String name) throws LogConfigurationException; </p>
<p>public static Log getLog(Class class) throws LogConfigurationException; </p>
<p>注：name 参数作为日志器的名字；class<br>参数指定类名作为日志器名字。</p>
<ol>
<li>log4j 基本编程方法</li>
</ol>
<p>以上是从原理方面说明Log4j 的使用方法，在具体Java 编程使用Log4j 可以参照以下示例：</p>
<p>2.1 建立Logger 实例</p>
<p>语法表示：public static Logger getLogger( String<br>name)</p>
<p>　　实际使用：static<br>Logger logger = Logger.getLogger(ServerWithLog4j.class.getName ()) </p>
<p>2.2读取配置文件 </p>
<p>获得了Logger 的实例之后，接下来将配置Log4j 使用环境：</p>
<p>　　语法表示：</p>
<p>　　BasicConfigurator.configure()<br>：自动快速地使用缺省Log4j 环境。</p>
<p>　　PropertyConfigurator.configure(String<br>configFilename) ：读取使用Java 的特性文件编写的配置文件。</p>
<p>　　DOMConfigurator.configure(String<br>filename) ：读取XML 形式的配置文件。</p>
<p>　　实际使用：</p>
<p>PropertyConfigurator.configure(“log4j.properties”);</p>
<p>若log4j.properties 放在工程的根目录，可以不写上面的程序语句，程序会自动找到配置文件。</p>
<p>2.3插入日志信息 </p>
<p>完成了以上两个步骤以后，下面就可以按日志的不同级别插入到你要记录日志的任何地方了。</p>
<p>　　语法表示：</p>
<p>　　Logger.debug(Object<br>message);// 调试信息</p>
<p>　　Logger.info(Object<br>message);// 一般信息</p>
<p>　　Logger.warn(Object<br>message);// 警告信息</p>
<p>　　Logger.error(Object<br>message);// 错误信息</p>
<p>　　Logger.fatal(Object<br>message);// 致命错误信息 </p>
<p>实际使用：logger.info(“ServerSocket before<br>accept: “ + server); </p>
<ol>
<li>log4j 配置文件</li>
</ol>
<p>在实际编程时，要使Log4j 真正在系统中运行事先还要对配置文件进行定义。定义步骤就是对Logger 、Appender 及Layout 的分别使用。</p>
<p>Log4j 支持两种配置文件格式，一种是XML 格式的文件，一种是java properties （key=value ）【Java 特性文件（键= 值）】。</p>
<p>3.1 使用properties文件配置文件</p>
<p>3.1.1 配置根Logger</p>
<p>其语法为：</p>
<p>log4j.rootLogger = [ level ] , appenderName1,<br>appenderName2, …</p>
<p>level : 是日志记录的优先级，分为OFF 、FATAL 、ERROR 、WARN 、INFO 、DEBUG 、ALL 或者您定义的级别。Log4j 建议只使用四个级别，优先级从高到低分别是ERROR 、WARN 、INFO 、DEBUG 。通过在这里定义的级别，您可以控制到应用程序中相应级别的日志信息的开关。比如在这里定义了INFO 级别，则应用程序中所有DEBUG 级别的日志信息将不被打印出来。</p>
<p>appenderName: 就是指定日志信息输出到哪个地方。您可以同时指定多个输出目的地。</p>
<p>例如：log4j.rootLogger ＝info,A1,B2,C3</p>
<p>3.1.2 配置日志信息输出目的地</p>
<p>其语法为：</p>
<p>log4j.appender.appenderName =<br>fully.qualified.name.of.appender.class </p>
<p>“fully.qualified.name.of.appender.class” 可以指定下面五个目的地中的一个：</p>
<p>1.org.apache.log4j.ConsoleAppender<br>（控制台）</p>
<p>2.org.apache.log4j.FileAppender （文件）</p>
<p>3.org.apache.log4j.DailyRollingFileAppender （每天产生一个日志文件）</p>
<p>4.org.apache.log4j.RollingFileAppender （文件大小到达指定尺寸的时候产生一个新的文件）</p>
<p>5.org.apache.log4j.WriterAppender （将日志信息以流格式发送到任意指定的地方）</p>
<p>3.1.2.1 ConsoleAppender 选项 </p>
<p>Threshold=WARN: 指定日志消息的输出最低层次。</p>
<p>ImmediateFlush=true: 默认值是true, 意味着所有的消息都会被立即输出。</p>
<p>Target=System.err<br>：默认情况下是：System.out,<br>指定输出控制台</p>
<p>3.1.2.2 FileAppender 选项</p>
<p>Threshold=WARN:<br>指定日志消息的输出最低层次。</p>
<p>ImmediateFlush=true:<br>默认值是true, 意谓着所有的消息都会被立即输出。</p>
<p>File=mylog.txt:<br>指定消息输出到mylog.txt 文件。</p>
<p>Append=false: 默认值是true, 即将消息增加到指定文件中，false 指将消息覆盖指定的文件内容。</p>
<p>3.1.2.3 DailyRollingFileAppender 选项</p>
<p>Threshold=WARN:<br>指定日志消息的输出最低层次。</p>
<p>ImmediateFlush=true:<br>默认值是true, 意谓着所有的消息都会被立即输出。</p>
<p>File=mylog.txt:<br>指定消息输出到mylog.txt 文件。</p>
<p>Append=false:<br>默认值是true, 即将消息增加到指定文件中，false 指将消息覆盖指定的文件内容。</p>
<p>DatePattern=’.’yyyy-ww: 每周滚动一次文件，即每周产生一个新的文件。当然也可以指定按月、周、天、时和分。即对应的格式如下：(单引号中的点.在文件名中就代表一个点.)</p>
<p>1)’.’yyyy-MM: 每月</p>
<p>2)’.’yyyy-ww: 每周 </p>
<p>3)’.’yyyy-MM-dd: 每天</p>
<p>4)’.’yyyy-MM-dd-a: 每天两次</p>
<p>5)’.’yyyy-MM-dd-HH: 每小时</p>
<p>6)’.’yyyy-MM-dd-HH-mm: 每分钟</p>
<p>3.1.2.4 RollingFileAppender 选项</p>
<p>Threshold=WARN:<br>指定日志消息的输出最低层次。</p>
<p>ImmediateFlush=true:<br>默认值是true, 意谓着所有的消息都会被立即输出。</p>
<p>File=mylog.txt:<br>指定消息输出到mylog.txt 文件。</p>
<p>Append=false:<br>默认值是true, 即将消息增加到指定文件中，false 指将消息覆盖指定的文件内容。</p>
<p>MaxFileSize=100KB: 后缀可以是KB, MB 或者是 GB. 在日志文件到达该大小时，将会自动滚动，即将原来的内容移到mylog.log.1 文件。</p>
<p>MaxBackupIndex=2: 指定可以产生的滚动文件的最大数。 </p>
<p>实际应用：</p>
<p>log4j.appender.A1=org.apache.log4j.ConsoleAppender<br>// 这里指定了日志输出的第一个位置A1 是控制台ConsoleAppender </p>
<p>3.1.3 配置日志信息的格式<br>(即布局方式)</p>
<p>其语法为：</p>
<p>log4j.appender.appenderName.layout = fully.qualified.name.of.layout.class </p>
<p>“fully.qualified.name.of.layout.class”<br>可以指定下面4 个格式中的一个：</p>
<p>1.org.apache.log4j.HTMLLayout （以HTML 表格形式布局）</p>
<p>2.org.apache.log4j.PatternLayout （可以灵活地指定布局模式）</p>
<p>3.org.apache.log4j.SimpleLayout （包含日志信息的级别和信息字符串）</p>
<p>4.org.apache.log4j.TTCCLayout （包含日志产生的时间、线程、类别等等信息）</p>
<p>1.HTMLLayout 选项</p>
<p>LocationInfo=true: 默认值是false, 输出java 文件名称和行号</p>
<p>Title=my app<br>file: 默认值是 Log4J Log Messages.</p>
<p>2.PatternLayout 选项</p>
<p>ConversionPattern=%m%n : 指定格式化指定消息的方式。</p>
<p>3.XMLLayout 选项</p>
<p>LocationInfo=true:<br>默认值是false, 输出java 文件和行号</p>
<p>实际应用：</p>
<p>log4j.appender.A1.layout=org.apache.log4j.PatternLayout </p>
<p>log4j.appender. appenderName.layout.ConversionPattern=%-5p %d{yyyy-MM-dd HH:mm:ssS} %c %m%n</p>
<p>这里需要说明的就是日志信息格式中几个符号所代表的含义：</p>
<p>－X : X 信息输出时左对齐； </p>
<p>%p: 输出日志信息优先级，即DEBUG ，INFO ，WARN ，ERROR ，FATAL,</p>
<p>%m: 输出代码中指定的消息, 产生的日志具体信息</p>
<p>%d: 输出日志时间点的日期或时间，默认格式为ISO8601 ，也可以在其后指定格式，比如：%d{yyy MMM dd HH:mm:ss,SSS} ，输出类似：2002 年10 月18 日 22 ：10 ：28 ，921</p>
<p>%c: 输出日志信息所属的类目，通常就是所在类的全名（包含包名）</p>
<p>%F: 输出日志消息产生时所在的文件名称（即类名）</p>
<p>%t: 输出产生该日志事件的线程名(即方法名)</p>
<p>%l: 输出日志事件的发生位置，相当于%C.%M(%F:%L) 的组合, 包括类目名、发生的线程，以及在代码中的行数。（包含包、类、方法、行号）举例：Testlog4.main(TestLog4.java:10)</p>
<p>%L: 输出代码中的行号（只有行号）</p>
<p>%n: 输出一个回车换行符，Windows 平台为”/r/n” ，Unix 平台为”/n” 输出日志信息换行</p>
<p>%r:<br>输出自应用启动到输出该log 信息耗费的毫秒数</p>
<p>%x:<br>输出和当前线程相关联的NDC( 嵌套诊断环境), 尤其用到像java servlets 这样的多客户多线程的应用中。</p>
<p>%%: 输出一个”%” 字符</p>
<p>可以在% 与模式字符之间加上修饰符来控制其最小宽度、最大宽度、和文本的对齐方式。如：</p>
<p>1)%20c ：指定输出category 的名称，最小的宽度是20 ，如果category 的名称小于20 的话，默认的情况下右对齐。</p>
<p>2)%-20c: 指定输出category 的名称，最小的宽度是20 ，如果category 的名称小于20 的话，”-“ 号指定左对齐。</p>
<p>3)%.30c: 指定输出category 的名称，最大的宽度是30 ，如果category 的名称大于30 的话，就会将左边多出的字符截掉，但小于30 的话也不会有空格。</p>
<p>4)%20.30c: 如果category 的名称小于20 就补空格，并且右对齐，如果其名称长于30 字符，就从左边交远销出的字符截掉。</p>
<p>3.1.4 Log4j日志对应用性能的影响</p>
<p>如果在程序运行中输出大量日志，显然会对应用的性能造成一定的影响。Log4J 对性能的影响取决于以下因素： </p>
<p>日志输出目的地：输出到控制台的速度和输出到文件系统的速度是不一样的。 </p>
<p>日志输出格式：格式简单，速度也更快。 </p>
<p>日志级别：日志级别设置的越低，输出的日志内容越多，对性能的影响也越大。</p>
<p>3.1.5 举例说明</p>
<p>上面三个步骤是对前面Log4j 组件进行了简要的说明， 下面给出得 Log4J配置文件实现了输出到控制台，文件，回滚文件，发送日志邮件，输出到数据库日志表，自定义标签等全套功能。</p>
<p>log4j.rootLogger=DEBUG,CONSOLE,FILE,ROLLING_FILE,MAIL,DATABASE,DIFINE</p>
<p>log4j.addivity.org.apache=true </p>
<h6 id="#">#</h6>
<h1 id="Console_Appender(控制台)">Console Appender(控制台)</h1>
<h6 id="#-1">#</h6>
<p>log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</p>
<p>log4j.appender.CONSOLE.Threshold=DEBUG</p>
<p>log4j.appender.CONSOLE.Target=System.out</p>
<p>log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.CONSOLE.layout.ConversionPattern=[framework]<br>%d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<h6 id="#-2">#</h6>
<h1 id="File_Appender(文件)">File Appender(文件)</h1>
<h6 id="#-3">#</h6>
<p>log4j.appender.FILE=org.apache.log4j.FileAppender</p>
<p>log4j.appender.FILE.File=file.log</p>
<p>log4j.appender.FILE.Append=true</p>
<p>log4j.appender.FILE.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.FILE.layout.ConversionPattern=[framework]<br>%d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<h6 id="#-4">#</h6>
<h1 id="Rolling_File(回滚文件)">Rolling File(回滚文件)</h1>
<h6 id="#-5">#</h6>
<p>log4j.appender.ROLLING_FILE=org.apache.log4j.RollingFileAppender</p>
<p>log4j.appender.ROLLING_FILE.Threshold=ERROR</p>
<p>log4j.appender.ROLLING_FILE.File=rolling.log</p>
<p>log4j.appender.ROLLING_FILE.Append=true</p>
<p>log4j.appender.ROLLING_FILE.MaxFileSize=10KB</p>
<p>log4j.appender.ROLLING_FILE.MaxBackupIndex=1</p>
<p>log4j.appender.ROLLING_FILE.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.ROLLING_FILE.layout.ConversionPattern=[framework]<br>%d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<h6 id="#-6">#</h6>
<h1 id="SMTP_Appender(发送日志邮件)">SMTP Appender(发送日志邮件)</h1>
<h6 id="#-7">#</h6>
<p>log4j.appender.MAIL=org.apache.log4j.net.SMTPAppender</p>
<p>log4j.appender.MAIL.Threshold=FATAL</p>
<p>log4j.appender.MAIL.BufferSize=10</p>
<p>log4j.appender.MAIL.From=chenyl@hollycrm.com</p>
<p>log4j.appender.MAIL.SMTPHost=mail.hollycrm.com</p>
<p>log4j.appender.MAIL.Subject=Log4J Message</p>
<p>log4j.appender.MAIL.To=chenyl@hollycrm.com</p>
<p>log4j.appender.MAIL.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.MAIL.layout.ConversionPattern=[framework]<br>%d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<h6 id="#-8">#</h6>
<h1 id="JDBC_Appender(输出到数据库日志表)">JDBC Appender(输出到数据库日志表)</h1>
<h6 id="#-9">#</h6>
<p>log4j.appender.DATABASE=org.apache.log4j.jdbc.JDBCAppender</p>
<p>log4j.appender.DATABASE.URL=jdbc:mysql://localhost:3306/test</p>
<p>log4j.appender.DATABASE.driver=com.mysql.jdbc.Driver</p>
<p>log4j.appender.DATABASE.user=root</p>
<p>log4j.appender.DATABASE.password=</p>
<p>log4j.appender.DATABASE.sql=INSERT INTO<br>LOG4J (Message) VALUES (‘[framework] %d - %c -%-4r [%t] %-5p %c %x - %m%n’)</p>
<p>log4j.appender.DATABASE.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.DATABASE.layout.ConversionPattern=[framework]<br>%d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<h6 id="#-10">#</h6>
<h1 id="自定义_Appender">自定义 Appender</h1>
<h6 id="#-11">#</h6>
<p>log4j.appender.DIFINE =<br>net.cybercorlin.util.logger.appender.IMAppender</p>
<p>log4j.appender.DIFINE.host =<br>mail.cybercorlin.net</p>
<p>log4j.appender.DIFINE.username = username</p>
<p>log4j.appender.DIFINE.password = password</p>
<p>log4j.appender.DIFINE.recipient =<br>corlin@cybercorlin.net</p>
<p>log4j.appender.DIFINE.layout=org.apache.log4j.PatternLayout</p>
<p>log4j.appender.DIFINE.layout.ConversionPattern<br>=[framework] %d - %c -%-4r [%t] %-5p %c %x - %m%n</p>
<p>3.2 使用XML 配置文件</p>
<p>3.2.1 控制台输出的xml文件配置解说及Java调用</p>
<p>首先，看看下面的XML 配置文件示例：</p>
<p>version=”1.0” encoding=”UTF-8” ?&gt;</p>
<p>log4j:configuration SYSTEM “log4j.dtd”&gt;</p>
<p><log4j:configuration<br>xmlns:log4j=”<a href="http://jakarta.apache.org/log4j/" target="_blank" rel="external">http://jakarta.apache.org/log4j/</a> “&gt;</log4j:configuration<br></p>
<p><appender<br>name=”ConsoleAppender”<br>class=”org.apache.log4j.ConsoleAppender”&gt;</appender<br></p>
<layout class="org.apache.log4j.SimpleLayout"><br><br><br><br><br><br><root><br><br><br><priority value<br="">=”debug” /&gt;<br><br><br><appender-ref<br>ref=”ConsoleAppender”/&gt;<br><br><br></appender-ref<br></priority></root><br><br><br><br><br><br>文件以标准的XML 声明作为开始，后面跟着指出DTD（文档类型定义）的DOCTYPE<br>声明，它定义了XML 文件的结构，例如，什么元素可以嵌入在其他元素中等等。上面文件在log4j 发行版的src/java/org/apache/log4j/xml 目录中。<br><br><br>接着看看封装所有元素的<br>log4j:configuration 元素，它在DOCTYPE 声明中被指定为根元素。嵌入在根元素中有两个结构：<br><br><br><br><appender<br>name=”ConsoleAppender”<br>class=”org.apache.log4j.ConsoleAppender”&gt;<br><br><br><layout<br>class=”org.apache.log4j.SimpleLayout”/&gt;<br><br><br><br><br><br>这里创建一个名叫”ConsoleAppender”<br>的Appender，注意:你可以选择任何名字，该示例之所以选择”ConsoleAppender” ，完全是为了示例的设计。接着这个appender<br>类以全名形式给出，经常用规范（fully qualified ）类名。 Appender 必须具有一个指定的 name 和class 。嵌入在 Appender 之内的是 layout 元素，这里它被指定为SimpleLayout 。 Layout 必须具有一个 class 属性。<br><br><br><br><root><br><br><br><priority<br>value =”debug” /&gt;<br><br><br><appender-ref<br>ref=”ConsoleAppender”/&gt;<br><br><br></appender-ref<br></priority<br></root><br><br><br>root 元素必须存在且不能被子类化。示例中的优先级被设置为”debug” ，设置appender 饱含一个appender-ref 元素。还有更多的属性或元素可以指定。查看log4j 发行版中的src/java/org/apache/log4j/xml/log4j.dtd 以了解关于XML 配置文件结构的更多信息。<br><br><br>可以用下面这种方法把配置信息文件读入到Java<br>程序中:<br><br><br>DOMConfigurator.configure(“configurationfile.xml”); // DOMConfigurator<br>用一棵DOM 树来初始化log4j 环境。这里是示例中的XML 配置文件：configurationfile.xml 。<br><br><br>这里是执行该配置文件的java 程序:<br><br><br>import org.apache.log4j.Logger;<br><br><br>import<br>org.apache.log4j.xml.DOMConfigurator;<br><br><br>public class externalxmltest {<br><br><br>static<br>Logger logger = Logger.getLogger(filetest.class);<br><br><br>public<br>static void main(String args[]) {<br><br><br>DOMConfigurator.configure(“xmllog4jconfig.xml”);<br><br><br>logger.debug(“Here<br>is some DEBUG”);<br><br><br>logger.info(“Here<br>is some INFO”);<br><br><br>logger.warn(“Here<br>is some WARN”);<br><br><br>logger.error(“Here<br>is some ERROR”);<br><br><br>logger.fatal(“Here<br>is some FATAL”);<br><br><br>}<br><br><br>}<br><br><br>3.2.2 文件形式日志输出<br><br><br>对于带有PatternLayout 的FileAppender 的日志记录器Logger 的XML 配置文件:<br><br><br><br><br><br><br><br><br><log4j:configuration<br>xmlns:log4j=”<a href="http://jakarta.apache.org/log4j/" target="_blank" rel="external">http://jakarta.apache.org/log4j/</a> “&gt;<br><br><br><appender<br>name=”appender” class=”org.apache.log4j.FileAppender”&gt;<br><br><br><param<br>name=”File” value=”Indentify-Log.txt”/&gt;<br><br><br><param<br>name=”Append” value=”true”/&gt;<br><br><br><layout<br>class=”org.apache.log4j.PatternLayout”&gt;<br><br><br><param<br>name=”ConversionPattern” value=”%d [%t] %p - %m%n”/&gt;<br><br><br></param<br></layout<br></param<br></param<br></appender<br></log4j:configuration<br></layout<br></appender<br></layout>





<root><br><br><br><priority<br>value =”info”/&gt;<br><br><br><appender-ref<br>ref=”appender”/&gt;<br><br><br></appender-ref<br></priority<br></root>


<h2></h2>
<p> from:<a href="https://www.textarea.com/qdwyg2013/log4j-141/" target="_blank" rel="external">https://www.textarea.com/qdwyg2013/log4j-141/</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kim.biudoor.com/2015/08/09/log4j/" data-id="cstt4dxbi4js48jb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log/">log</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log4j/">log4j</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/07/01/疯狂的麦克斯/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">疯狂的麦克斯</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/个人/">个人</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/电影/">电影</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/film/">film</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log/">log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j/">log4j</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开始/">开始</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/我/">我</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅游/">旅游</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志/">日志</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/说明/">说明</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/辞职/">辞职</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java/" style="font-size: 10.00px;">Java</a><a href="/tags/film/" style="font-size: 20.00px;">film</a><a href="/tags/log/" style="font-size: 10.00px;">log</a><a href="/tags/log4j/" style="font-size: 10.00px;">log4j</a><a href="/tags/开始/" style="font-size: 20.00px;">开始</a><a href="/tags/我/" style="font-size: 20.00px;">我</a><a href="/tags/旅游/" style="font-size: 10.00px;">旅游</a><a href="/tags/日志/" style="font-size: 10.00px;">日志</a><a href="/tags/说明/" style="font-size: 10.00px;">说明</a><a href="/tags/辞职/" style="font-size: 10.00px;">辞职</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/08/09/log4j/">羊肉粉</a>
          </li>
        
          <li>
            <a href="/2015/07/01/疯狂的麦克斯/">疯狂的麦克斯</a>
          </li>
        
          <li>
            <a href="/2015/05/14/2015-05-14/">羊肉粉</a>
          </li>
        
          <li>
            <a href="/2015/05/09/2015-05-09/">羊肉粉</a>
          </li>
        
          <li>
            <a href="/2014/11/12/一路向北/">一路向北</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 yangroufen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>